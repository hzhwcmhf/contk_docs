

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Metric &mdash; cotk  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/cotk_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Resources" href="resources.html" />
    <link rel="prev" title="Word Vector" href="wordvector.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> cotk
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/tutorial_core.html">GRU Language Model: Load Data and Evaluate Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/tutorial_cli.html">CLI Usage: Fast Model Reproduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extend.html">Extending Cotk: More Data, More Metrics!</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/FAQ.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dataloader.html">Data Loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="wordvector.html">Word Vector</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Metric</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hash-value">Hash Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-classes">Basic Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metric-class">Metric class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metric-like-class">Metric-like class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Zoo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="models/LanguageGeneration/index.html">LanguageGeneration</a></li>
<li class="toctree-l1"><a class="reference internal" href="models/SingleTurnDialog/index.html">SingleTurnDialog</a></li>
<li class="toctree-l1"><a class="reference internal" href="models/MultiTurnDialog/index.html">MultiTurnDialog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cotk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Metric</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/metric.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-cotk.metric">
<span id="metric"></span><h1>Metric<a class="headerlink" href="#module-cotk.metric" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">cotk.metric</span></code> provides commonly used metrics for <code class="docutils literal notranslate"><span class="pre">cotk.dataloader</span></code>.
All metric objects receive a batch of data per one call of <code class="docutils literal notranslate"><span class="pre">forward</span></code>.
The batch of data is represented by a dict which contains models’ outputs and
answers. The answers are highly relevant to the corresponding
dataloader, where the type, shape are usually identical with the return value of
<code class="docutils literal notranslate"><span class="pre">get_batch</span></code> in dataloader, as long as the correct key name is set.
<code class="docutils literal notranslate"><span class="pre">forward</span></code> function can be called several times and at last
<code class="docutils literal notranslate"><span class="pre">close</span></code> can be called for results.</p>
<p>Here is an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span> <span class="o">=</span> <span class="n">OpenSubtitles</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metric</span> <span class="o">=</span> <span class="n">BleuCorpusMetric</span><span class="p">(</span><span class="n">gen_key</span><span class="o">=</span><span class="s2">&quot;gen&quot;</span><span class="p">,</span>\
<span class="gp">... </span>    <span class="n">reference_allvocabs_key</span><span class="o">=</span><span class="s2">&quot;resp_allvocabs_key&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="c1"># &quot;resp_allvocabs_key&quot; is a key name in get_batch()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dm</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">])</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="s2">&quot;resp_allvocabs_key&quot;</span> <span class="ow">in</span> <span class="n">data</span>
<span class="gp">... </span>    <span class="n">metric</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
<span class="go">{&quot;bleu&quot;: 0.135, &quot;bleu hashvalue&quot;: b&quot;XXXX&quot;}</span>
</pre></div>
</div>
<p>We also provide default metrics in dataloader, you can use “get_metric”-like
functions (example: <a class="reference internal" href="dataloader.html#cotk.dataloader.SingleTurnDialog.get_inference_metric" title="cotk.dataloader.SingleTurnDialog.get_inference_metric"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SingleTurnDialog.get_inference_metric()</span></code></a>) to get
default metrics and avoid the mess with complex key name.</p>
<p>Here is an exmample:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span> <span class="o">=</span> <span class="n">OpenSubtitles</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metric</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">get_inference_metric</span><span class="p">(</span><span class="n">gen_key</span><span class="o">=</span><span class="s2">&quot;gen&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dm</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;gen&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">metric</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
<span class="go">{&quot;bleu&quot;: 0.135, &quot;bleu hashvalue&quot;: b&quot;XXXX&quot;, ...}</span>
</pre></div>
</div>
<div class="section" id="hash-value">
<span id="hash-ref"></span><h2>Hash Value<a class="headerlink" href="#hash-value" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#cotk.metric.MetricBase.close" title="cotk.metric.MetricBase.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetricBase.close()</span></code></a> will return a dict containing hash value,
which can validate whether two models used the same test data and the
same setting. Only two models using the same metric with the same hash
value returned, can compare with each other.</p>
</div>
<div class="section" id="basic-classes">
<span id="metric-ref"></span><h2>Basic Classes<a class="headerlink" href="#basic-classes" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cotk.metric.MetricBase">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">MetricBase</code><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for metrics.</p>
<dl class="method">
<dt id="cotk.metric.MetricBase._hash_relevant_data">
<code class="descname">_hash_relevant_data</code><span class="sig-paren">(</span><em>data_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricBase._hash_relevant_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricBase._hash_relevant_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Invoked by <a class="reference internal" href="#cotk.metric.MetricBase.forward" title="cotk.metric.MetricBase.forward"><code class="xref py py-meth docutils literal notranslate"><span class="pre">forward()</span></code></a> or <a class="reference internal" href="#cotk.metric.MetricBase.close" title="cotk.metric.MetricBase.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> to hash relevant data when computing a metric.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data_list</strong> (<em>list</em>) – relevant data organized as list.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MetricBase._hashvalue">
<code class="descname">_hashvalue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricBase._hashvalue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricBase._hashvalue" title="Permalink to this definition">¶</a></dt>
<dd><p>Invoked by <a class="reference internal" href="#cotk.metric.MetricBase.close" title="cotk.metric.MetricBase.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> to return the recorded hash value.</p>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MetricBase.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricBase.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricBase.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<em>dict</em>) – A dict contains the data that metrics need.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MetricBase.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricBase.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricBase.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the metric and return results. Once the metric is closed,
any operation on the metric (e.g. forward or another close) will raise a ValueError.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(dict) which contains results.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="metric-class">
<h2>Metric class<a class="headerlink" href="#metric-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cotk.metric.BleuPrecisionRecallMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">BleuPrecisionRecallMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>ngram</em>, <em>generated_num_per_context</em>, <em>candidates_allvocabs_key='candidate_allvocabs'</em>, <em>multiple_gen_key='multiple_gen'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#BleuPrecisionRecallMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.BleuPrecisionRecallMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating sentence BLEU precision and recall.</p>
<p class="rubric">References</p>
<p>[1] Zhao, T., Zhao, R., &amp; Eskenazi, M. (2017). Learning discourse-level diversity
for neural dialog models using conditional variational autoencoders.
arXiv preprint arXiv:1703.10960.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>generated_num_per_context</strong> (<em>int</em>) – The number of sentences generated per context.</li>
<li><strong>candidate_allvocabs_key</strong> (<em>str</em>) – The key of reference sentences. Default: <code class="docutils literal notranslate"><span class="pre">candidate_allvocabs</span></code>.</li>
<li><strong>multiple_gen_key</strong> (<em>str</em>) – The key of multiple generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">multiple_gen</span></code>.</li>
<li><strong>ngram</strong> (<em>int</em>) – Specifies using BLEU-ngram.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.BleuPrecisionRecallMetric._score">
<code class="descname">_score</code><span class="sig-paren">(</span><em>gen</em>, <em>reference</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#BleuPrecisionRecallMetric._score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.BleuPrecisionRecallMetric._score" title="Permalink to this definition">¶</a></dt>
<dd><p>Score function of BLEU-ngram precision and recall.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gen</strong> (<em>list</em>) – list of generated word ids.</li>
<li><strong>reference</strong> (<em>list</em>) – list of word ids of a reference.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>int</em> – score in [0, 1].</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Here is an Example:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reference</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
<span class="go">0.150 # assume self.weights = [0.25,0.25,0.25,0.25]</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.BleuPrecisionRecallMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cotk.metric.BleuPrecisionRecallMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(dict) returns a dict which contains<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">res_prefix</span></code> <strong>precision</strong>: average precision.</li>
<li><code class="docutils literal notranslate"><span class="pre">res_prefix</span></code> <strong>recall</strong>: average recall.</li>
<li><code class="docutils literal notranslate"><span class="pre">res_prefix</span></code> <strong>hashvalue</strong>: hash value for precision &amp; recall metric, same hash value stands
for same evaluation settings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.BleuPrecisionRecallMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.metric.BleuPrecisionRecallMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[candidate_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged list of index. Multiple reference sentences for a single context.
Does not contain start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~sentence_num,</span> <span class="pre">~word_num]</span></code>, where “~” means different sizes
in this dimension is allowed.</li>
<li><strong>data[multiple_gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged or padded array.
Sentences generated by model. Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>),
but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">generated_num_per_context,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="n">candidate_allvocabs_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]]</span>
<span class="gp">... </span>            <span class="n">multiple_gen_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.EmbSimilarityPrecisionRecallMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">EmbSimilarityPrecisionRecallMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>word2vec</em>, <em>mode</em>, <em>generated_num_per_context</em>, <em>candidates_allvocabs_key='candidate_allvocabs'</em>, <em>multiple_gen_key='multiple_gen'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#EmbSimilarityPrecisionRecallMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.EmbSimilarityPrecisionRecallMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating cosine similarity precision and recall.</p>
<p class="rubric">References</p>
<p>[1] Zhao, T., Zhao, R., &amp; Eskenazi, M. (2017). Learning discourse-level diversity
for neural dialog models using conditional variational autoencoders.
arXiv preprint arXiv:1703.10960.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>generated_num_per_context</strong> (<em>int</em>) – The number of sentences generated per context.</li>
<li><strong>candidate_allvocabs_key</strong> (<em>str</em>) – The key of reference sentences. Default: <code class="docutils literal notranslate"><span class="pre">candidate_allvocabs</span></code>.</li>
<li><strong>multiple_gen_key</strong> (<em>str</em>) – The key of multiple generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">multiple_gen</span></code>.</li>
<li><strong>word2vec</strong> (<em>dict</em>) – Maps a word (str) to its pretrained embedding (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or list)</li>
<li><strong>mode</strong> (<em>str</em>) – Specifies the operation that computes the bag-of-word representation.
Must be <code class="docutils literal notranslate"><span class="pre">avg</span></code> or <code class="docutils literal notranslate"><span class="pre">extrema</span></code>:<ul>
<li><code class="docutils literal notranslate"><span class="pre">avg</span></code> : element-wise average word embeddings.</li>
<li><code class="docutils literal notranslate"><span class="pre">extrema</span></code> : element-wise maximum word embeddings.</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.EmbSimilarityPrecisionRecallMetric._score">
<code class="descname">_score</code><span class="sig-paren">(</span><em>gen</em>, <em>reference</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#EmbSimilarityPrecisionRecallMetric._score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.EmbSimilarityPrecisionRecallMetric._score" title="Permalink to this definition">¶</a></dt>
<dd><p>Score function of cosine similarity precision and recall.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gen</strong> (<em>list</em>) – list of generated word ids.</li>
<li><strong>reference</strong> (<em>list</em>) – list of word ids of a reference.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>int</em> – cosine similarity between two sentence embeddings in [0, 1].</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Here is an Example:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reference</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
<span class="go">0.135 # assume self.mode = &#39;avg&#39;</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.EmbSimilarityPrecisionRecallMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cotk.metric.EmbSimilarityPrecisionRecallMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(dict) returns a dict which contains<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">res_prefix</span></code> <strong>precision</strong>: average precision.</li>
<li><code class="docutils literal notranslate"><span class="pre">res_prefix</span></code> <strong>recall</strong>: average recall.</li>
<li><code class="docutils literal notranslate"><span class="pre">res_prefix</span></code> <strong>hashvalue</strong>: hash value for precision &amp; recall metric, same hash value stands
for same evaluation settings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.EmbSimilarityPrecisionRecallMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.metric.EmbSimilarityPrecisionRecallMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[candidate_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged list of index. Multiple reference sentences for a single context.
Does not contain start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~sentence_num,</span> <span class="pre">~word_num]</span></code>, where “~” means different sizes
in this dimension is allowed.</li>
<li><strong>data[multiple_gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged or padded array.
Sentences generated by model. Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>),
but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">generated_num_per_context,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="n">candidate_allvocabs_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]]</span>
<span class="gp">... </span>            <span class="n">multiple_gen_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.PerplexityMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">PerplexityMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>reference_allvocabs_key='ref_allvocabs'</em>, <em>reference_len_key='ref_length'</em>, <em>gen_log_prob_key='gen_log_prob'</em>, <em>invalid_vocab=False</em>, <em>full_check=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#PerplexityMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.PerplexityMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating perplexity.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>reference_allvocabs_key</strong> (<em>str</em>) – The key of reference sentences. Default: <code class="docutils literal notranslate"><span class="pre">ref_allvocabs</span></code>.</li>
<li><strong>reference_len_key</strong> (<em>str</em>) – The key of lengths of reference sentences.
Default: <code class="docutils literal notranslate"><span class="pre">ref_length</span></code>.</li>
<li><strong>gen_log_prob_key</strong> (<em>str</em>) – The key of <strong>log</strong> probability over words.
Default: <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code>.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – Whether <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code> contains <a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">invalid vocab</span></a>.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li><strong>full_check</strong> (<em>bool</em>) – Whether perform a full check on <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code> to make sure the sum
of probability is 1. Otherwise, a random check will be performed for efficiency.
If pytorch is used, a full check is always performed and this argument will be ignored.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.PerplexityMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#PerplexityMetric.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.PerplexityMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data. Smoothing will be performed for <a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">invalid vocabs</span></a>.
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">Unknowns vocabs</span></a> will be ignored.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[reference_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code>):
A 2-d jagged or padded array of int. Reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a> in index form.
Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~ref_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[reference_len_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
Length of reference sentences. Contains start token (eg:<code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>)
and end token (eg:<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>). Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code>.</li>
<li><strong>data[gen_log_prob_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code>):
The <strong>log softmax</strong> probability of the sentence generations model outputs.
A 3-d jagged or padded array of float.
Contains end token (eg:<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>), but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length,</span> <span class="pre">vocab_size]</span></code> for <code class="docutils literal notranslate"><span class="pre">invalid_vocab</span> <span class="pre">=</span> <span class="pre">False</span></code>, or
<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length,</span> <span class="pre">all_vocab_size]</span></code> for <code class="docutils literal notranslate"><span class="pre">invalid_vocab</span> <span class="pre">=</span> <span class="pre">True</span></code>,
where “~” means different sizes in this dimension is allowed.
If <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code> is used, the following data should also be
<code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code>.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="n">reference_allvocabs_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span>            <span class="n">reference_len_key</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="gp">... </span>            <span class="n">gen_log_prob_key</span><span class="p">:</span> <span class="p">[[[</span><span class="o">-</span><span class="mf">3.80666249</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.11351531</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7080502</span> <span class="p">,</span> <span class="o">-</span><span class="mf">2.42036813</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.19722458</span><span class="p">,</span>
<span class="go">                        -2.01490302, -1.86075234, -1.72722095, -1.60943791],...],...]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">data[gen_log_prob_key]</span></code> must be processed after log_softmax. That means,
<code class="docutils literal notranslate"><span class="pre">np.sum(np.exp(gen_log_prob),</span> <span class="pre">-1)</span></code> equals <code class="docutils literal notranslate"><span class="pre">np.ones((batch_size,</span> <span class="pre">gen_sentence_length))</span></code></p>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.PerplexityMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#PerplexityMetric.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.PerplexityMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>perplexity</strong>: perplexity value.</li>
<li><strong>perplexity hashvalue</strong>: hash value for perplexity metric, same hash value stands
for same evaluation settings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.MultiTurnPerplexityMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">MultiTurnPerplexityMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>multi_turn_reference_allvocabs_key='multi_turn_ref_allvocabs'</em>, <em>multi_turn_reference_len_key='multi_turn_ref_length'</em>, <em>multi_turn_gen_log_prob_key='multi_turn_gen_log_prob'</em>, <em>invalid_vocab=False</em>, <em>full_check=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnPerplexityMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnPerplexityMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating multi-turn perplexity.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>multi_turn_reference_allvocabs_key</strong> (<em>str</em>) – The key of reference sentences. Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_ref_allvocabs</span></code>.</li>
<li><strong>multi_turn_reference_len_key</strong> (<em>str</em>) – The key of lengths of reference sentences.
Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_ref_length</span></code>.</li>
<li><strong>gen_log_prob_key</strong> (<em>str</em>) – The key of <strong>log</strong> probability over words.
Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_gen_log_prob</span></code>.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – whether <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code> contains <a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">invalid vocab</span></a>.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li><strong>full_check</strong> (<em>bool</em>) – whether perform full checks on <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code> to make sure the sum
of probability is 1. Otherwise, a random check will be performed for efficiency.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.MultiTurnPerplexityMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnPerplexityMetric.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnPerplexityMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[multi_turn_reference_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code>):
A 3-d jagged or padded array of int. Multi-turn reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">all vocabs</span></a>. Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and
end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>). Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length,</span> <span class="pre">~sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[multi_turn_reference_len_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int. <strong>If padded, redundant position must be set to</strong> <code class="docutils literal notranslate"><span class="pre">0</span></code>.
Length of multi-turn reference sentences. Contains start token (eg:<code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>)
and end token (eg:<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>). Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[multi_turn_gen_log_prob_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or                                      <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code>):
The <strong>log softmax</strong> probability of the sentence generations model outputs.
A 4-d jagged or padded array. <strong>log softmax</strong> probability.
Contains end token (eg:<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>), but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length,</span> <span class="pre">vocab_size]</span></code> for <code class="docutils literal notranslate"><span class="pre">invalid_vocab</span> <span class="pre">=</span> <span class="pre">False</span></code>, or
<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length,</span> <span class="pre">all_vocab_size]`</span> <span class="pre">for</span> <span class="pre">``invalid_vocab</span> <span class="pre">=</span> <span class="pre">True</span></code>,
where “~” means different sizes in this dimension is allowed.
If <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code> is used, the following data should also be
<code class="xref py py-class docutils literal notranslate"><span class="pre">torch.Tensor</span></code>.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="n">multi_turn_reference_allvocabs_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span>            <span class="n">multi_turn_reference_len_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
<span class="gp">... </span>            <span class="n">multi_turn_gen_log_prob_key</span><span class="p">:</span> <span class="p">[[[[</span><span class="o">-</span><span class="mf">3.80666249</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.11351531</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7080502</span><span class="p">,</span>
<span class="go">                        -2.42036813, -2.19722458, -2.01490302, -1.86075234, -1.72722095,</span>
<span class="go">                        -1.60943791], ...], ...], ...]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">data[multi_turn_gen_log_prob_key]</span></code> must be processed after log_softmax. That means,
<code class="docutils literal notranslate"><span class="pre">np.sum(np.exp(multi_turn_gen_log_prob_key),</span> <span class="pre">-1)</span></code> equals
<code class="docutils literal notranslate"><span class="pre">np.ones((batch_size,</span> <span class="pre">~gen_sentence_length))</span></code></p>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MultiTurnPerplexityMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnPerplexityMetric.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnPerplexityMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>perplexity</strong>: perplexity value.</li>
<li><strong>perplexity hashvalue</strong>: hash value for perplexity metric, same hash value stands
for same evaluation settings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.BleuCorpusMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">BleuCorpusMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>ignore_smoothing_error=False</em>, <em>reference_allvocabs_key='ref_allvocabs'</em>, <em>gen_key='gen'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#BleuCorpusMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.BleuCorpusMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating BLEU.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>reference_allvocabs_key</strong> (<em>str</em>) – The key of reference sentences. Default: <code class="docutils literal notranslate"><span class="pre">ref_allvocabs</span></code>.</li>
<li><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.BleuCorpusMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#BleuCorpusMetric.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.BleuCorpusMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[reference_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int. Reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a> in index form.
Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~ref_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int.
Sentences generated by model. Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>),
but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="n">reference_allvocabs_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span>            <span class="n">gen_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.BleuCorpusMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#BleuCorpusMetric.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.BleuCorpusMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>bleu</strong>: bleu value.</li>
<li><strong>bleu hashvalue</strong>: hash value for bleu metric, same hash value stands
for same evaluation settings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.SelfBleuCorpusMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">SelfBleuCorpusMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>gen_key='gen'</em>, <em>sample=1000</em>, <em>seed=1229</em>, <em>cpu_count=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#SelfBleuCorpusMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.SelfBleuCorpusMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating Self-BLEU.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</li>
<li><strong>sample</strong> (<em>int</em>) – Number of examples sampled from the generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">1000</span></code>.</li>
<li><strong>seed</strong> (<em>int</em>) – Random seed for sampling. Default: <code class="docutils literal notranslate"><span class="pre">1229</span></code>.</li>
<li><strong>cpu_count</strong> (<em>int</em>) – Number of used cpu for multiprocessing. Multiprocessing will <strong>NOT</strong> be used
when <code class="docutils literal notranslate"><span class="pre">cpu_count</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code> or the dataset is small. Default: if <code class="docutils literal notranslate"><span class="pre">None</span></code>,
the environment variable <code class="docutils literal notranslate"><span class="pre">CPU_COUNT</span></code> will be used     when it is set,
or all available cpu will be used otherwise.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<dl class="last docutils">
<dt>the calculation of <code class="docutils literal notranslate"><span class="pre">hashvalue</span></code> considers the actual sample size of hypotheses which</dt>
<dd>will be less than <code class="docutils literal notranslate"><span class="pre">sample</span></code> if the size of hypotheses is smaller than <code class="docutils literal notranslate"><span class="pre">sample</span></code></dd>
</dl>
</div>
<dl class="method">
<dt id="cotk.metric.SelfBleuCorpusMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#SelfBleuCorpusMetric.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.SelfBleuCorpusMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int.
Sentences generated by model. Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>),
but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="n">gen_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.SelfBleuCorpusMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#SelfBleuCorpusMetric.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.SelfBleuCorpusMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>self-bleu</strong>: self-bleu value.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.FwBwBleuCorpusMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">FwBwBleuCorpusMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>reference_test_key</em>, <em>gen_key='gen'</em>, <em>sample=1000</em>, <em>seed=1229</em>, <em>cpu_count=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#FwBwBleuCorpusMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.FwBwBleuCorpusMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating FwBw-BLEU.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>reference_test_key</strong> (<em>str</em>) – Reference sentences with <a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">all vocabs</span></a> in test data
are passed to <a class="reference internal" href="#cotk.metric.FwBwBleuCorpusMetric.forward" title="cotk.metric.FwBwBleuCorpusMetric.forward"><code class="xref py py-func docutils literal notranslate"><span class="pre">forward()</span></code></a> by <code class="docutils literal notranslate"><span class="pre">dataloader.data[&quot;test&quot;][self.reference_test_key]</span></code>.</li>
<li><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</li>
<li><strong>sample</strong> (<em>int</em>) – Number of examples sampled from the generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">1000</span></code>.</li>
<li><strong>seed</strong> (<em>int</em>) – random seed for sampling. Default: <code class="docutils literal notranslate"><span class="pre">1229</span></code>.</li>
<li><strong>cpu_count</strong> (<em>int</em>) – Number of used cpu for multiprocessing. Multiprocessing will <strong>NOT</strong> be used
when <code class="docutils literal notranslate"><span class="pre">cpu_count</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code> or the dataset is small. Default: if <code class="docutils literal notranslate"><span class="pre">None</span></code>,
the environment variable <code class="docutils literal notranslate"><span class="pre">CPU_COUNT</span></code> will be used     when it is set,
or all available cpu will be used otherwise.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The calculation of <code class="docutils literal notranslate"><span class="pre">hashvalue</span></code> considers the actual sample size of hypotheses and
references. Therefore <code class="docutils literal notranslate"><span class="pre">hashvalue</span></code> may vary with the size of hypothesis or references
if the size of them is smaller than <code class="docutils literal notranslate"><span class="pre">sample</span></code>.</p>
</div>
<dl class="method">
<dt id="cotk.metric.FwBwBleuCorpusMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#FwBwBleuCorpusMetric.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.FwBwBleuCorpusMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int.
Sentences generated by model. Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>),
but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="n">gen_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.FwBwBleuCorpusMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#FwBwBleuCorpusMetric.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.FwBwBleuCorpusMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>fwbwbleu</strong>: fw/bw bleu value.</li>
<li><strong>fw-bw-bleu hashvalue</strong>: hash value for fwbwbleu metric, same hash value stands
for same evaluation settings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.MultiTurnBleuCorpusMetric">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">MultiTurnBleuCorpusMetric</code><span class="sig-paren">(</span><em>dataloader</em>, <em>ignore_smoothing_error=False</em>, <em>multi_turn_reference_allvocabs_key='reference_allvocabs'</em>, <em>multi_turn_gen_key='multi_turn_gen'</em>, <em>turn_len_key='turn_length'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnBleuCorpusMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnBleuCorpusMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Metric for calculating multi-turn BLEU.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>multi_turn_reference_allvocabs_key</strong> (<em>str</em>) – The key of reference sentences. Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_ref_allvocabs</span></code>.</li>
<li><strong>multi_turn_gen_key</strong> (<em>str</em>) – The key of generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_gen</span></code>.</li>
<li><strong>turn_length</strong> (<em>str</em>) – The key of length of turns. Default: <code class="docutils literal notranslate"><span class="pre">turn_length</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.MultiTurnBleuCorpusMetric.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnBleuCorpusMetric.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnBleuCorpusMetric.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[multi_turn_reference_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged or padded array of int. Multi-turn reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">all vocabs</span></a>. Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and
end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>). Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length,</span> <span class="pre">~sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged or padded array of int. Sentences generated by model.
Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>), but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~max_turn_length,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[turn_len_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
Length of turns in each sample.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code>.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="n">multi_turn_reference_allvocabs_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span>            <span class="n">turn_len_key</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>            <span class="n">gen_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MultiTurnBleuCorpusMetric.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnBleuCorpusMetric.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnBleuCorpusMetric.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>bleu</strong>: bleu value.</li>
<li><strong>bleu hashvalue</strong>: hash value for bleu metric, same hash value stands
for same evaluation settings.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="metric-like-class">
<h2>Metric-like class<a class="headerlink" href="#metric-like-class" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cotk.metric.SingleTurnDialogRecorder">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">SingleTurnDialogRecorder</code><span class="sig-paren">(</span><em>dataloader</em>, <em>post_allvocabs_key='post_allvocabs'</em>, <em>resp_allvocabs_key='resp_allvocabs'</em>, <em>gen_key='gen'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#SingleTurnDialogRecorder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.SingleTurnDialogRecorder" title="Permalink to this definition">¶</a></dt>
<dd><p>A metric-like class for recording generated sentences and references.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>post_allvocabs_key</strong> (<em>str</em>) – The key of dialog posts with <a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a>.
Default: <code class="docutils literal notranslate"><span class="pre">post_allvocabs</span></code>.</li>
<li><strong>resp_allvocabs_key</strong> (<em>str</em>) – The key of dialog responses with <a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a>.
Default: <code class="docutils literal notranslate"><span class="pre">resp_allvocabs</span></code>.</li>
<li><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.SingleTurnDialogRecorder.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#SingleTurnDialogRecorder.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.SingleTurnDialogRecorder.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[post_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int. Reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a> in index form.
Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~ref_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[resp_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int. Reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a> in index form.
Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~ref_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int.
Sentences generated by model. Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>),
but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="n">post_allvocabs_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span>            <span class="n">resp_allvocabs_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span>            <span class="n">gen_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.SingleTurnDialogRecorder.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#SingleTurnDialogRecorder.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.SingleTurnDialogRecorder.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>post</strong>: a list of post sentences. A jagged 2-d array of int.
Size:<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~sent_length]</span></code>, where “~” means different
sizes in this dimension is allowed.</li>
<li><strong>resp</strong>: a list of response sentences. A jagged 2-d array of int.
Size:<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~sent_length]</span></code>, where “~” means different
sizes in this dimension is allowed.</li>
<li><strong>gen</strong>: A list of generated sentences. A jagged 2-d array of int.
Size:<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~sent_length]</span></code>, where “~” means different
sizes in this dimension is allowed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.MultiTurnDialogRecorder">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">MultiTurnDialogRecorder</code><span class="sig-paren">(</span><em>dataloader</em>, <em>multi_turn_context_allvocabs_key='multi_turn_context_allvocabs'</em>, <em>multi_turn_reference_allvocabs_key='multi_turn_ref_allvocabs'</em>, <em>multi_turn_gen_key='multi_turn_gen'</em>, <em>turn_len_key='turn_length'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnDialogRecorder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnDialogRecorder" title="Permalink to this definition">¶</a></dt>
<dd><p>A metric-like class for recording generated sentences and references.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>multi_turn_context_allvocabs_key</strong> (<em>str</em>) – The key of dialog context with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a>. Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_context_allvocabs</span></code>.</li>
<li><strong>multi_turn_reference_allvocabs_key</strong> (<em>str</em>) – The key of dialog references with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">allvocabs</span></a>. Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_ref_allvocabs</span></code>.</li>
<li><strong>multi_turn_gen_key</strong> (<em>str</em>) – The key of generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">multi_turn_gen</span></code>.</li>
<li><strong>turn_length</strong> (<em>str</em>) – The key of length of turns. Default: <code class="docutils literal notranslate"><span class="pre">turn_length</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.MultiTurnDialogRecorder.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnDialogRecorder.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnDialogRecorder.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[multi_turn_context_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged or padded array of int. Multi-turn reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">all vocabs</span></a>. Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and
end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>). Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length,</span> <span class="pre">~sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[multi_turn_reference_allvocabs_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged or padded array of int. Multi-turn reference sentences with
<a class="reference internal" href="dataloader.html#vocab-ref"><span class="std std-ref">all vocabs</span></a>. Contains start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>) and
end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>). Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length,</span> <span class="pre">~sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 3-d jagged or padded array of int. Sentences generated by model.
Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>), but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~max_turn_length,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
<li><strong>data[turn_len_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
Length of turns in each sample.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code>.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="n">multi_turn_context_allvocabs_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span>            <span class="n">multi_turn_reference_allvocabs_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span>            <span class="n">multi_turn_gen_key</span><span class="p">:</span> <span class="p">[[[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">]]]</span>
<span class="gp">... </span>            <span class="n">turn_len_key</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MultiTurnDialogRecorder.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MultiTurnDialogRecorder.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MultiTurnDialogRecorder.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>context</strong>: a list of post sentences. A jagged 3-d array of int.
Size:<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length,</span> <span class="pre">~sent_length]</span></code>, where “~” means different
sizes in this dimension is allowed.</li>
<li><strong>reference</strong>: a list of response sentences. A jagged 3-d array of int.
Size:<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length,</span> <span class="pre">~sent_length]</span></code>, where “~” means different
sizes in this dimension is allowed.</li>
<li><strong>gen</strong>: a list of generated sentences. A jagged 3-d array of int.
Size:<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~turn_length,</span> <span class="pre">~sent_length]</span></code>, where “~” means different
sizes in this dimension is allowed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.LanguageGenerationRecorder">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">LanguageGenerationRecorder</code><span class="sig-paren">(</span><em>dataloader</em>, <em>gen_key='gen'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#LanguageGenerationRecorder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.LanguageGenerationRecorder" title="Permalink to this definition">¶</a></dt>
<dd><p>A metric-like class for recorder generated sentences.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataloader</strong> (<a class="reference internal" href="dataloader.html#cotk.dataloader.LanguageProcessingBase" title="cotk.dataloader.LanguageProcessingBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataloader.LanguageProcessingBase</span></code></a>) – A language generation dataloader.</li>
<li><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences. Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cotk.metric.LanguageGenerationRecorder.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#LanguageGenerationRecorder.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.LanguageGenerationRecorder.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> (<em>dict</em>) – A dict at least contains the following keys:</p>
<ul class="simple">
<li><strong>data[gen_key]</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d jagged or padded array of int.
Sentences generated by model. Contains end token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>),
but without start token (eg: <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~gen_sentence_length]</span></code>,
where “~” means different sizes in this dimension is allowed.</li>
</ul>
<dl class="last docutils">
<dt>Here is an example for data:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>            <span class="n">gen_key</span><span class="p">:</span> <span class="p">[[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.LanguageGenerationRecorder.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#LanguageGenerationRecorder.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.LanguageGenerationRecorder.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – Return a dict which contains<ul class="simple">
<li><strong>gen</strong>: a list of generated sentences. A jagged 2-d array of int.
Size:<code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~sent_length]</span></code>, where “~” means different
sizes in this dimension is allowed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.metric.MetricChain">
<em class="property">class </em><code class="descclassname">cotk.metric.</code><code class="descname">MetricChain</code><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricChain"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricChain" title="Permalink to this definition">¶</a></dt>
<dd><p>A metric-like class for stacked metric. You can use this class
making multiples metric combination like one.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">metric</span> <span class="o">=</span> <span class="n">MetricChain</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metric</span><span class="o">.</span><span class="n">add_metric</span><span class="p">(</span><span class="n">BleuCorpusMetric</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metric</span><span class="o">.</span><span class="n">add_metric</span><span class="p">(</span><span class="n">SingleDialogRecorder</span><span class="p">(</span><span class="n">dataloader</span><span class="p">))</span>
</pre></div>
</div>
<p>Todo: Give more examples to combining forward and close</p>
<dl class="method">
<dt id="cotk.metric.MetricChain.add_metric">
<code class="descname">add_metric</code><span class="sig-paren">(</span><em>metric</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricChain.add_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricChain.add_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Add metric for processing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>metric</strong> (<em>MetricBase</em>) – a metric class.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MetricChain.forward">
<code class="descname">forward</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricChain.forward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricChain.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Processing a batch of data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<em>dict</em>) – A dict at least contains keys which all the
metric components need.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.metric.MetricChain.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/metric/metric.html#MetricChain.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.metric.MetricChain.close" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(dict)</em> – A dict which contains the items which all the
metric components returned.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="resources.html" class="btn btn-neutral float-right" title="Resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="wordvector.html" class="btn btn-neutral float-left" title="Word Vector" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, thu-coai

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>