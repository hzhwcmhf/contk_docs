

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Loader &mdash; cotk  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/cotk_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Word Vector" href="wordvector.html" />
    <link rel="prev" title="Quick Start" href="notes/quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> cotk
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/quickstart.html">Quick Start</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Loader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#languagegeneration">LanguageGeneration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mscoco">MSCOCO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#singleturndialog">SingleTurnDialog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#opensubtitles">OpenSubtitles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiturndialog">MultiTurnDialog</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ubuntucorpus">UbuntuCorpus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#switchboardcorpus">SwitchBoardCorpus</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wordvector.html">Word Vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="metric.html">Metric</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="seq2seq_tf_link.html">Seq2Seq (TensorFlow)</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cotk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Data Loader</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/dataloader.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-cotk.dataloader">
<span id="data-loader"></span><h1>Data Loader<a class="headerlink" href="#module-cotk.dataloader" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">cotk.dataloader</span></code> provides classes and functions downloading and
loading benchmark data automatically. It reduces your cost preprocessing
data and provide a fair dataset for every model. It also helps you adapt
your model from one dataset to other datasets.</p>
<dl class="class">
<dt id="cotk.dataloader.Dataloader">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">Dataloader</code><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#Dataloader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.Dataloader" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class of Dataloader.</p>
<dl class="classmethod">
<dt id="cotk.dataloader.Dataloader.get_all_subclasses">
<em class="property">classmethod </em><code class="descname">get_all_subclasses</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.Dataloader.get_all_subclasses" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a generator of all subclasses.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(generator) A iterator over all subclasses.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="cotk.dataloader.Dataloader.load_class">
<em class="property">classmethod </em><code class="descname">load_class</code><span class="sig-paren">(</span><em>class_name</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.Dataloader.load_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a subclass of <code class="docutils literal notranslate"><span class="pre">class_name</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>class_name</strong> (<em>str</em>) – target class name.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(class) The subclass specified by <code class="docutils literal notranslate"><span class="pre">class_name</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cotk.dataloader.GenerationBase">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">GenerationBase</code><span class="sig-paren">(</span><em>ext_vocab=None</em>, <em>key_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for all language generation datasets. This is an abstract class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code></li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens, placed at beginning of <code class="docutils literal notranslate"><span class="pre">vocab_list</span></code>.
For example: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code>.</li>
<li><strong>pad_id</strong> (<em>int</em>) – token for padding, always equal to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</li>
<li><strong>unk_id</strong> (<em>int</em>) – token for unknown words, always equal to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</li>
<li><strong>go_id</strong> (<em>int</em>) – token at the beginning of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</li>
<li><strong>eos_id</strong> (<em>int</em>) – token at the end of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">3</span></code>.</li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. For example: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code>.</li>
<li><strong>all_vocab_list</strong> (<em>list</em>) – vocabulary list of the datasets,
including valid vocabs and invalid vocabs.</li>
<li><strong>word2id</strong> (<em>dict</em>) – a dict mapping all vocab to index. You don’t need to use it
at most times, see <a class="reference internal" href="#cotk.dataloader.GenerationBase.convert_tokens_to_ids" title="cotk.dataloader.GenerationBase.convert_tokens_to_ids"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_tokens_to_ids()</span></code></a> instead.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="cotk.dataloader.GenerationBase.vocab_list">
<code class="descname">vocab_list</code><a class="headerlink" href="#cotk.dataloader.GenerationBase.vocab_list" title="Permalink to this definition">¶</a></dt>
<dd><p>valid vocab list, equals to <code class="docutils literal notranslate"><span class="pre">all_vocab_list[：valid_vocab_len]</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.GenerationBase.vocab_size">
<code class="descname">vocab_size</code><a class="headerlink" href="#cotk.dataloader.GenerationBase.vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">valid_vocab_len</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.GenerationBase.all_vocab_size">
<code class="descname">all_vocab_size</code><a class="headerlink" href="#cotk.dataloader.GenerationBase.all_vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">len(self.all_vocab_list)</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase._load_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called during the initialization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(tuple)</em> – containing:<ul class="simple">
<li><strong>all_vocab_list</strong> (list): vocabulary list of the datasets,
including valid and invalid vocabs.</li>
<li><strong>valid_vocab_len</strong> (int): the number of valid vocab.
<code class="docutils literal notranslate"><span class="pre">vocab_list[:valid_vocab_len]</span></code> will be regarded as valid vocabs,
while <code class="docutils literal notranslate"><span class="pre">vocab_list[valid_vocab_len:]</span></code> regarded as invalid vocabs.</li>
<li><strong>data</strong> (dict): a dict contains data.</li>
<li><strong>data_size</strong> (dict): a dict contains size of each item in data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase._valid_word2id">
<code class="descname">_valid_word2id</code><span class="sig-paren">(</span><em>word</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase._valid_word2id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase._valid_word2id" title="Permalink to this definition">¶</a></dt>
<dd><p>This function return the id for a valid word, otherwise return <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>word</strong> (<em>str</em>) – a word.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase.restart">
<code class="descname">restart</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase.restart"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase.restart" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize batches. This function be called before <a class="reference internal" href="#cotk.dataloader.GenerationBase.get_next_batch" title="cotk.dataloader.GenerationBase.get_next_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batch()</span></code></a>
or an epoch is end.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int</em>) – the number of sample in a batch.
default: if <code class="docutils literal notranslate"><span class="pre">None</span></code>, last <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> is used.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase.get_batch">
<code class="descname">get_batch</code><span class="sig-paren">(</span><em>key</em>, <em>index</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase.get_batch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase.get_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a batch of specified <cite>index</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>index</strong> (<em>list</em>) – a list of specified index.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dict. See examples in subclasses.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase.get_next_batch">
<code class="descname">get_next_batch</code><span class="sig-paren">(</span><em>key</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase.get_next_batch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase.get_next_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get next batch. It can be called only after Initializing batches (<a class="reference internal" href="#cotk.dataloader.GenerationBase.restart" title="cotk.dataloader.GenerationBase.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dict like <a class="reference internal" href="#cotk.dataloader.GenerationBase.get_batch" title="cotk.dataloader.GenerationBase.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>, or None if the epoch is end.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase.get_batches">
<code class="descname">get_batches</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase.get_batches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase.get_batches" title="Permalink to this definition">¶</a></dt>
<dd><p>An iterator over batches. It first call <a class="reference internal" href="#cotk.dataloader.GenerationBase.restart" title="cotk.dataloader.GenerationBase.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>, and then <code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batches()</span></code>                      until no more data is available.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int, optional</em>) – default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.  Use <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> by default.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">An iterator where each element is like <a class="reference internal" href="#cotk.dataloader.GenerationBase.get_batch" title="cotk.dataloader.GenerationBase.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase.trim_index">
<code class="descname">trim_index</code><span class="sig-paren">(</span><em>index</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase.trim_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase.trim_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Trim a sentence represented by index. There will be two steps:</p>
<blockquote>
<div><ul class="simple">
<li>If there is an end token (<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>) in the sentence,
find first end token and abandon words after it (included the end token).</li>
<li>ignore <code class="docutils literal notranslate"><span class="pre">&lt;pad&gt;</span></code> s at the end of the sentence.</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>index</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – a list of int</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>(list)</em> – a list of trimmed index</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">trim_index</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">... </span><span class="c1"># &lt;go&gt; I have been to China &lt;pad&gt; &lt;pad&gt; &lt;eos&gt; I &lt;eos&gt; &lt;pad&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="c1"># &lt;go&gt; I have been to China</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase.convert_tokens_to_ids">
<code class="descname">convert_tokens_to_ids</code><span class="sig-paren">(</span><em>sent</em>, <em>invalid_vocab=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase.convert_tokens_to_ids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase.convert_tokens_to_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from string to index representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sent</strong> (<em>list</em>) – a list of string, representing each token of the sentences.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – whether to provide invalid vocabs.
If <code class="docutils literal notranslate"><span class="pre">False</span></code>, invalid vocabs will be replaced by <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, invalid vocabs will using their own id.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of indexes</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;, &quot;been&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.GenerationBase.convert_ids_to_tokens">
<code class="descname">convert_ids_to_tokens</code><span class="sig-paren">(</span><em>index</em>, <em>trim=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/dataloader.html#GenerationBase.convert_ids_to_tokens"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.GenerationBase.convert_ids_to_tokens" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from index to string representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>list</em>) – a list of int.</li>
<li><strong>trim</strong> (<em>bool</em>) – if True, call <a class="reference internal" href="#cotk.dataloader.GenerationBase.trim_index" title="cotk.dataloader.GenerationBase.trim_index"><code class="xref py py-func docutils literal notranslate"><span class="pre">trim_index()</span></code></a> before convertion.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of tokens</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<div class="section" id="languagegeneration">
<h2>LanguageGeneration<a class="headerlink" href="#languagegeneration" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cotk.dataloader.LanguageGeneration">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">LanguageGeneration</code><span class="sig-paren">(</span><em>ext_vocab=None</em>, <em>key_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/language_generation.html#LanguageGeneration"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.LanguageGeneration" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for language modelling datasets. This is an abstract class.</p>
<p>This class is supported for language modeling tasks or language generation tasks
without any inputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code></li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens, placed at beginning of <code class="docutils literal notranslate"><span class="pre">vocab_list</span></code>.
For example: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code>.</li>
<li><strong>pad_id</strong> (<em>int</em>) – token for padding, always equal to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</li>
<li><strong>unk_id</strong> (<em>int</em>) – token for unknown words, always equal to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</li>
<li><strong>go_id</strong> (<em>int</em>) – token at the beginning of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</li>
<li><strong>eos_id</strong> (<em>int</em>) – token at the end of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">3</span></code>.</li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. For example: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code>.</li>
<li><strong>all_vocab_list</strong> (<em>list</em>) – vocabulary list of the datasets,
including valid vocabs and invalid vocabs.</li>
<li><strong>word2id</strong> (<em>dict</em>) – a dict mapping all vocab to index. You don’t need to use it
at most times, see <a class="reference internal" href="#cotk.dataloader.LanguageGeneration.convert_tokens_to_ids" title="cotk.dataloader.LanguageGeneration.convert_tokens_to_ids"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_tokens_to_ids()</span></code></a> instead.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="cotk.dataloader.LanguageGeneration.vocab_list">
<code class="descname">vocab_list</code><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.vocab_list" title="Permalink to this definition">¶</a></dt>
<dd><p>valid vocab list, equals to <code class="docutils literal notranslate"><span class="pre">all_vocab_list[：valid_vocab_len]</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.LanguageGeneration.vocab_size">
<code class="descname">vocab_size</code><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">valid_vocab_len</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.LanguageGeneration.all_vocab_size">
<code class="descname">all_vocab_size</code><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.all_vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">len(self.all_vocab_list)</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called during the initialization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(tuple)</em> – containing:<ul class="simple">
<li><strong>all_vocab_list</strong> (list): vocabulary list of the datasets,
including valid and invalid vocabs.</li>
<li><strong>valid_vocab_len</strong> (int): the number of valid vocab.
<code class="docutils literal notranslate"><span class="pre">vocab_list[:valid_vocab_len]</span></code> will be regarded as valid vocabs,
while <code class="docutils literal notranslate"><span class="pre">vocab_list[valid_vocab_len:]</span></code> regarded as invalid vocabs.</li>
<li><strong>data</strong> (dict): a dict contains data.</li>
<li><strong>data_size</strong> (dict): a dict contains size of each item in data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration._valid_word2id">
<code class="descname">_valid_word2id</code><span class="sig-paren">(</span><em>word</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration._valid_word2id" title="Permalink to this definition">¶</a></dt>
<dd><p>This function return the id for a valid word, otherwise return <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>word</strong> (<em>str</em>) – a word.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.restart">
<code class="descname">restart</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.restart" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize batches. This function be called before <a class="reference internal" href="#cotk.dataloader.LanguageGeneration.get_next_batch" title="cotk.dataloader.LanguageGeneration.get_next_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batch()</span></code></a>
or an epoch is end.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int</em>) – the number of sample in a batch.
default: if <code class="docutils literal notranslate"><span class="pre">None</span></code>, last <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> is used.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.get_batch">
<code class="descname">get_batch</code><span class="sig-paren">(</span><em>key</em>, <em>index</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/language_generation.html#LanguageGeneration.get_batch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.get_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a batch of specified <cite>index</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>index</strong> (<em>list</em>) – a list of specified index</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p><em>(dict)</em> – A dict at least contains:</p>
<ul class="simple">
<li><strong>sent_length</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 1-d array, the length of sentence in each batch.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code></li>
<li><strong>sent</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 2-d padding array containing id of words.
Only provide valid words. <code class="docutils literal notranslate"><span class="pre">unk_id</span></code> will be used if a word is not valid.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(sent_length)]</span></code></li>
<li><strong>sent_allvocabs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 2-d padding array containing id of words.
Provide both valid and invalid words.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(sent_length)]</span></code></li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;hello&quot;, &quot;i&quot;, &quot;am&quot;, &quot;fine&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;, &quot;hello&quot;, &quot;i&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">get_batch</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="go">{</span>
<span class="go">        &quot;sent&quot;: numpy.array([</span>
<span class="go">                [2, 4, 5, 6, 3, 0],   # first sentence: &lt;go&gt; how are you &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 3, 0, 0, 0],   # second sentence:  &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 8, 1, 1, 3]    # third sentence: &lt;go&gt; hello i &lt;unk&gt; &lt;unk&gt; &lt;eos&gt;</span>
<span class="go">        ]),</span>
<span class="go">        &quot;sent_length&quot;: numpy.array([5, 3, 6]), # length of sentences</span>
<span class="go">        &quot;sent_allvocabs&quot;: numpy.array([</span>
<span class="go">                [2, 4, 5, 6, 3, 0],   # first sentence: &lt;go&gt; how are you &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 3, 0, 0, 0],   # second sentence:  &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 8, 9, 10, 3]   # third sentence: &lt;go&gt; hello i am fine &lt;eos&gt;</span>
<span class="go">        ]),</span>
<span class="go">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.get_next_batch">
<code class="descname">get_next_batch</code><span class="sig-paren">(</span><em>key</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.get_next_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get next batch. It can be called only after Initializing batches (<a class="reference internal" href="#cotk.dataloader.LanguageGeneration.restart" title="cotk.dataloader.LanguageGeneration.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dict like <a class="reference internal" href="#cotk.dataloader.LanguageGeneration.get_batch" title="cotk.dataloader.LanguageGeneration.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>, or None if the epoch is end.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.get_batches">
<code class="descname">get_batches</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.get_batches" title="Permalink to this definition">¶</a></dt>
<dd><p>An iterator over batches. It first call <a class="reference internal" href="#cotk.dataloader.LanguageGeneration.restart" title="cotk.dataloader.LanguageGeneration.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>, and then <code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batches()</span></code>                      until no more data is available.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int, optional</em>) – default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.  Use <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> by default.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">An iterator where each element is like <a class="reference internal" href="#cotk.dataloader.LanguageGeneration.get_batch" title="cotk.dataloader.LanguageGeneration.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.trim_index">
<code class="descname">trim_index</code><span class="sig-paren">(</span><em>index</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.trim_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Trim a sentence represented by index. There will be two steps:</p>
<blockquote>
<div><ul class="simple">
<li>If there is an end token (<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>) in the sentence,
find first end token and abandon words after it (included the end token).</li>
<li>ignore <code class="docutils literal notranslate"><span class="pre">&lt;pad&gt;</span></code> s at the end of the sentence.</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>index</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – a list of int</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>(list)</em> – a list of trimmed index</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">trim_index</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">... </span><span class="c1"># &lt;go&gt; I have been to China &lt;pad&gt; &lt;pad&gt; &lt;eos&gt; I &lt;eos&gt; &lt;pad&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="c1"># &lt;go&gt; I have been to China</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.convert_tokens_to_ids">
<code class="descname">convert_tokens_to_ids</code><span class="sig-paren">(</span><em>sent</em>, <em>invalid_vocab=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.convert_tokens_to_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from string to index representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sent</strong> (<em>list</em>) – a list of string, representing each token of the sentences.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – whether to provide invalid vocabs.
If <code class="docutils literal notranslate"><span class="pre">False</span></code>, invalid vocabs will be replaced by <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, invalid vocabs will using their own id.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of indexes</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;, &quot;been&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.convert_ids_to_tokens">
<code class="descname">convert_ids_to_tokens</code><span class="sig-paren">(</span><em>index</em>, <em>trim=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.convert_ids_to_tokens" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from index to string representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>list</em>) – a list of int.</li>
<li><strong>trim</strong> (<em>bool</em>) – if True, call <a class="reference internal" href="#cotk.dataloader.LanguageGeneration.trim_index" title="cotk.dataloader.LanguageGeneration.trim_index"><code class="xref py py-func docutils literal notranslate"><span class="pre">trim_index()</span></code></a> before convertion.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of tokens</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.get_teacher_forcing_metric">
<code class="descname">get_teacher_forcing_metric</code><span class="sig-paren">(</span><em>gen_log_prob_key='gen_log_prob'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/language_generation.html#LanguageGeneration.get_teacher_forcing_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.get_teacher_forcing_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metrics for teacher-forcing. In other words, this function
provides metrics for language modelling task.</p>
<p>It contains:</p>
<ul class="simple">
<li><a class="reference internal" href="metric.html#cotk.metric.PerplexityMetric" title="cotk.metric.PerplexityMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.PerplexityMetric</span></code></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>gen_log_prob_key</strong> (<em>str</em>) – The key of predicted log probablilty over words.
Refer to <a class="reference internal" href="metric.html#cotk.metric.PerplexityMetric" title="cotk.metric.PerplexityMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.PerplexityMetric</span></code></a>. Default: <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="metric.html#cotk.metric.MetricChain" title="cotk.metric.MetricChain"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MetricChain</span></code></a> object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.LanguageGeneration.get_inference_metric">
<code class="descname">get_inference_metric</code><span class="sig-paren">(</span><em>gen_key='gen'</em>, <em>sample=1000</em>, <em>seed=1229</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/language_generation.html#LanguageGeneration.get_inference_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.LanguageGeneration.get_inference_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metrics for inference. In other words, this function provides metrics for
language generation tasks.</p>
<p>It contains:</p>
<ul class="simple">
<li><a class="reference internal" href="metric.html#cotk.metric.SelfBleuCorpusMetric" title="cotk.metric.SelfBleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.SelfBleuCorpusMetric</span></code></a></li>
<li><a class="reference internal" href="metric.html#cotk.metric.FwBwBleuCorpusMetric" title="cotk.metric.FwBwBleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.FwBwBleuCorpusMetric</span></code></a></li>
<li><a class="reference internal" href="metric.html#cotk.metric.LanguageGenerationRecorder" title="cotk.metric.LanguageGenerationRecorder"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.LanguageGenerationRecorder</span></code></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences in index form.
Refer to <a class="reference internal" href="metric.html#cotk.metric.LanguageGenerationRecorder" title="cotk.metric.LanguageGenerationRecorder"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.LanguageGenerationRecorder</span></code></a>.
Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</li>
<li><strong>sample</strong> (<em>int</em>) – Sample numbers for self-bleu metric.
It will be fast but inaccurate if this become small.
Refer to <a class="reference internal" href="metric.html#cotk.metric.SelfBleuCorpusMetric" title="cotk.metric.SelfBleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.SelfBleuCorpusMetric</span></code></a>. Default: <code class="docutils literal notranslate"><span class="pre">1000</span></code>.</li>
<li><strong>seed</strong> (<em>int</em>) – Random seed for sampling.
Refer to <a class="reference internal" href="metric.html#cotk.metric.SelfBleuCorpusMetric" title="cotk.metric.SelfBleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.SelfBleuCorpusMetric</span></code></a>. Default: <code class="docutils literal notranslate"><span class="pre">1229</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="metric.html#cotk.metric.MetricChain" title="cotk.metric.MetricChain"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MetricChain</span></code></a> object.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<div class="section" id="mscoco">
<h3>MSCOCO<a class="headerlink" href="#mscoco" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="cotk.dataloader.MSCOCO">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">MSCOCO</code><span class="sig-paren">(</span><em>file_id='resources://MSCOCO'</em>, <em>min_vocab_times=10</em>, <em>max_sent_length=50</em>, <em>invalid_vocab_times=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/language_generation.html#MSCOCO"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MSCOCO" title="Permalink to this definition">¶</a></dt>
<dd><p>A dataloader for preprocessed MSCOCO dataset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>file_id</strong> (<em>str</em>) – A string indicating the source of MSCOCO dataset. Default: <code class="docutils literal notranslate"><span class="pre">resources://MSCOCO</span></code>.
A preset dataset is downloaded and cached.</li>
<li><strong>valid_vocab_times</strong> (<em>int</em>) – A cut-off threshold of valid tokens. All tokens appear
not less than <cite>min_vocab_times</cite> in <strong>training set</strong> will be marked as valid words.
Default: <code class="docutils literal notranslate"><span class="pre">10</span></code>.</li>
<li><strong>max_sent_length</strong> (<em>int</em>) – All sentences longer than <code class="docutils literal notranslate"><span class="pre">max_sent_length</span></code> will be shortened
to first <code class="docutils literal notranslate"><span class="pre">max_sent_length</span></code> tokens. Default: <code class="docutils literal notranslate"><span class="pre">50</span></code>.</li>
<li><strong>invalid_vocab_times</strong> (<em>int</em>) – A cut-off threshold of invalid tokens. All tokens appear
not less than <code class="docutils literal notranslate"><span class="pre">invalid_vocab_times</span></code> in the <strong>whole dataset</strong> (except valid words) will be
marked as invalid words. Otherwise, they are unknown words, which are ignored both for
model or metrics. Default: <code class="docutils literal notranslate"><span class="pre">0</span></code> (No unknown words).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Refer to <a class="reference internal" href="#cotk.dataloader.LanguageGeneration" title="cotk.dataloader.LanguageGeneration"><code class="xref py py-class docutils literal notranslate"><span class="pre">LanguageGeneration</span></code></a> for attributes and methods.</p>
<p class="rubric">References</p>
<p>[1] <a class="reference external" href="http://images.cocodataset.org/annotations/annotations_trainval2017.zip">http://images.cocodataset.org/annotations/annotations_trainval2017.zip</a></p>
<p>[2] Lin T Y, Maire M, Belongie S, et al. Microsoft COCO: Common Objects in Context. ECCV 2014.</p>
<dl class="method">
<dt id="cotk.dataloader.MSCOCO._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/language_generation.html#MSCOCO._load_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MSCOCO._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loading dataset, invoked during the initialization of <a class="reference internal" href="#cotk.dataloader.LanguageGeneration" title="cotk.dataloader.LanguageGeneration"><code class="xref py py-class docutils literal notranslate"><span class="pre">LanguageGeneration</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="singleturndialog">
<h2>SingleTurnDialog<a class="headerlink" href="#singleturndialog" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cotk.dataloader.SingleTurnDialog">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">SingleTurnDialog</code><span class="sig-paren">(</span><em>ext_vocab=None</em>, <em>key_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/single_turn_dialog.html#SingleTurnDialog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for single-turn dialog datasets. This is an abstract class.</p>
<p>This class is supported for sequence to sequence generation tasks, especially
single turn dialog tasks.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code></li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens, placed at beginning of <code class="docutils literal notranslate"><span class="pre">vocab_list</span></code>.
For example: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code>.</li>
<li><strong>pad_id</strong> (<em>int</em>) – token for padding, always equal to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</li>
<li><strong>unk_id</strong> (<em>int</em>) – token for unknown words, always equal to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</li>
<li><strong>go_id</strong> (<em>int</em>) – token at the beginning of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</li>
<li><strong>eos_id</strong> (<em>int</em>) – token at the end of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">3</span></code>.</li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. For example: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code>.</li>
<li><strong>all_vocab_list</strong> (<em>list</em>) – vocabulary list of the datasets,
including valid vocabs and invalid vocabs.</li>
<li><strong>word2id</strong> (<em>dict</em>) – a dict mapping all vocab to index. You don’t need to use it
at most times, see <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog.convert_tokens_to_ids" title="cotk.dataloader.SingleTurnDialog.convert_tokens_to_ids"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_tokens_to_ids()</span></code></a> instead.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="cotk.dataloader.SingleTurnDialog.vocab_list">
<code class="descname">vocab_list</code><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.vocab_list" title="Permalink to this definition">¶</a></dt>
<dd><p>valid vocab list, equals to <code class="docutils literal notranslate"><span class="pre">all_vocab_list[：valid_vocab_len]</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.SingleTurnDialog.vocab_size">
<code class="descname">vocab_size</code><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">valid_vocab_len</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.SingleTurnDialog.all_vocab_size">
<code class="descname">all_vocab_size</code><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.all_vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">len(self.all_vocab_list)</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called during the initialization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(tuple)</em> – containing:<ul class="simple">
<li><strong>all_vocab_list</strong> (list): vocabulary list of the datasets,
including valid and invalid vocabs.</li>
<li><strong>valid_vocab_len</strong> (int): the number of valid vocab.
<code class="docutils literal notranslate"><span class="pre">vocab_list[:valid_vocab_len]</span></code> will be regarded as valid vocabs,
while <code class="docutils literal notranslate"><span class="pre">vocab_list[valid_vocab_len:]</span></code> regarded as invalid vocabs.</li>
<li><strong>data</strong> (dict): a dict contains data.</li>
<li><strong>data_size</strong> (dict): a dict contains size of each item in data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog._valid_word2id">
<code class="descname">_valid_word2id</code><span class="sig-paren">(</span><em>word</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog._valid_word2id" title="Permalink to this definition">¶</a></dt>
<dd><p>This function return the id for a valid word, otherwise return <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>word</strong> (<em>str</em>) – a word.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.restart">
<code class="descname">restart</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.restart" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize batches. This function be called before <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog.get_next_batch" title="cotk.dataloader.SingleTurnDialog.get_next_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batch()</span></code></a>
or an epoch is end.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int</em>) – the number of sample in a batch.
default: if <code class="docutils literal notranslate"><span class="pre">None</span></code>, last <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> is used.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.get_batch">
<code class="descname">get_batch</code><span class="sig-paren">(</span><em>key</em>, <em>index</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/single_turn_dialog.html#SingleTurnDialog.get_batch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.get_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a batch of specified <cite>index</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>index</strong> (<em>list</em>) – a list of specified index</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p><em>(dict)</em> – A dict at least contains:</p>
<ul class="simple">
<li><strong>post_length</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 1-d array, the length of post in each batch.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code></li>
<li><strong>post</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 2-d padded array containing words of index form in posts.
Only provide valid words. <code class="docutils literal notranslate"><span class="pre">unk_id</span></code> will be used if a word is not valid.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(sent_length)]</span></code></li>
<li><strong>post_allvocabs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 2-d padded array containing words of index
form in posts. Provide both valid and invalid vocabs.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(sent_length)]</span></code></li>
<li><strong>resp_length</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 1-d array, the length of response in each batch.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code></li>
<li><strong>resp</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 2-d padded array containing words of index form
in responses. Only provide valid vocabs. <code class="docutils literal notranslate"><span class="pre">unk_id</span></code> will be used if a word is not valid.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(sent_length)]</span></code></li>
<li><strong>resp_allvocabs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>):
A 2-d padded array containing words of index form in responses.
Provide both valid and invalid vocabs.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(sent_length)]</span></code></li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;hello&quot;, &quot;i&quot;, &quot;am&quot;, &quot;fine&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;, &quot;hello&quot;, &quot;i&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">get_batch</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="go">{</span>
<span class="go">        &quot;post_allvocabs&quot;: numpy.array([</span>
<span class="go">                [2, 5, 6, 10, 3],  # first post:  &lt;go&gt; are you fine &lt;eos&gt;</span>
<span class="go">                [2, 7, 3, 0, 0],   # second post: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">        ]),</span>
<span class="go">        &quot;post&quot;: numpy.array([</span>
<span class="go">                [2, 5, 6, 1, 3],   # first post:  &lt;go&gt; are you &lt;unk&gt; &lt;eos&gt;</span>
<span class="go">                [2, 7, 3, 0, 0],   # second post: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">        ]),</span>
<span class="go">        &quot;resp_allvocabs&quot;: numpy.array([</span>
<span class="go">                [2, 8, 9, 10, 3],  # first response:  &lt;go&gt; i am fine &lt;eos&gt;</span>
<span class="go">                [2, 7, 3, 0, 0],   # second response: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">        ]),</span>
<span class="go">        &quot;resp&quot;: numpy.array([</span>
<span class="go">                [2, 8, 1, 1, 3],   # first response:  &lt;go&gt; i &lt;unk&gt; &lt;unk&gt; &lt;eos&gt;</span>
<span class="go">                [2, 7, 3, 0, 0],   # second response: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">        ]),</span>
<span class="go">        &quot;post_length&quot;: numpy.array([5, 3]), # length of posts</span>
<span class="go">        &quot;resp_length&quot;: numpy.array([5, 3]), # length of responses</span>
<span class="go">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.get_next_batch">
<code class="descname">get_next_batch</code><span class="sig-paren">(</span><em>key</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.get_next_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get next batch. It can be called only after Initializing batches (<a class="reference internal" href="#cotk.dataloader.SingleTurnDialog.restart" title="cotk.dataloader.SingleTurnDialog.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dict like <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog.get_batch" title="cotk.dataloader.SingleTurnDialog.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>, or None if the epoch is end.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.get_batches">
<code class="descname">get_batches</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.get_batches" title="Permalink to this definition">¶</a></dt>
<dd><p>An iterator over batches. It first call <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog.restart" title="cotk.dataloader.SingleTurnDialog.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>, and then <code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batches()</span></code>                      until no more data is available.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int, optional</em>) – default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.  Use <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> by default.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">An iterator where each element is like <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog.get_batch" title="cotk.dataloader.SingleTurnDialog.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.trim_index">
<code class="descname">trim_index</code><span class="sig-paren">(</span><em>index</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.trim_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Trim a sentence represented by index. There will be two steps:</p>
<blockquote>
<div><ul class="simple">
<li>If there is an end token (<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>) in the sentence,
find first end token and abandon words after it (included the end token).</li>
<li>ignore <code class="docutils literal notranslate"><span class="pre">&lt;pad&gt;</span></code> s at the end of the sentence.</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>index</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – a list of int</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>(list)</em> – a list of trimmed index</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">trim_index</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">... </span><span class="c1"># &lt;go&gt; I have been to China &lt;pad&gt; &lt;pad&gt; &lt;eos&gt; I &lt;eos&gt; &lt;pad&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="c1"># &lt;go&gt; I have been to China</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.convert_tokens_to_ids">
<code class="descname">convert_tokens_to_ids</code><span class="sig-paren">(</span><em>sent</em>, <em>invalid_vocab=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.convert_tokens_to_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from string to index representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sent</strong> (<em>list</em>) – a list of string, representing each token of the sentences.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – whether to provide invalid vocabs.
If <code class="docutils literal notranslate"><span class="pre">False</span></code>, invalid vocabs will be replaced by <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, invalid vocabs will using their own id.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of indexes</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;, &quot;been&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.convert_ids_to_tokens">
<code class="descname">convert_ids_to_tokens</code><span class="sig-paren">(</span><em>index</em>, <em>trim=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.convert_ids_to_tokens" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from index to string representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>list</em>) – a list of int.</li>
<li><strong>trim</strong> (<em>bool</em>) – if True, call <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog.trim_index" title="cotk.dataloader.SingleTurnDialog.trim_index"><code class="xref py py-func docutils literal notranslate"><span class="pre">trim_index()</span></code></a> before convertion.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of tokens</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.get_teacher_forcing_metric">
<code class="descname">get_teacher_forcing_metric</code><span class="sig-paren">(</span><em>gen_log_prob_key='gen_log_prob'</em>, <em>invalid_vocab=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/single_turn_dialog.html#SingleTurnDialog.get_teacher_forcing_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.get_teacher_forcing_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metrics for teacher-forcing.</p>
<p>It contains:</p>
<ul class="simple">
<li><a class="reference internal" href="metric.html#cotk.metric.PerplexityMetric" title="cotk.metric.PerplexityMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.PerplexityMetric</span></code></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>gen_log_prob_key</strong> (<em>str</em>) – The key of predicted log probablilty over words.
Refer to <a class="reference internal" href="metric.html#cotk.metric.PerplexityMetric" title="cotk.metric.PerplexityMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.PerplexityMetric</span></code></a>. Default: <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code>.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – Whether <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code> contains invalid vocab.
Refer to <a class="reference internal" href="metric.html#cotk.metric.PerplexityMetric" title="cotk.metric.PerplexityMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.PerplexityMetric</span></code></a>. Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="metric.html#cotk.metric.MetricChain" title="cotk.metric.MetricChain"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MetricChain</span></code></a> object.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SingleTurnDialog.get_inference_metric">
<code class="descname">get_inference_metric</code><span class="sig-paren">(</span><em>reference_allvocabs_key='resp_allvocabs'</em>, <em>gen_key='gen'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/single_turn_dialog.html#SingleTurnDialog.get_inference_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SingleTurnDialog.get_inference_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metrics for inference.</p>
<p>It contains:</p>
<ul class="simple">
<li><a class="reference internal" href="metric.html#cotk.metric.BleuCorpusMetric" title="cotk.metric.BleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.BleuCorpusMetric</span></code></a></li>
<li><a class="reference internal" href="metric.html#cotk.metric.SingleTurnDialogRecorder" title="cotk.metric.SingleTurnDialogRecorder"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.SingleTurnDialogRecorder</span></code></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences in index form.
Refer to <a class="reference internal" href="metric.html#cotk.metric.BleuCorpusMetric" title="cotk.metric.BleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.BleuCorpusMetric</span></code></a> or
<a class="reference internal" href="metric.html#cotk.metric.SingleTurnDialogRecorder" title="cotk.metric.SingleTurnDialogRecorder"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.SingleTurnDialogRecorder</span></code></a>. Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="metric.html#cotk.metric.MetricChain" title="cotk.metric.MetricChain"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MetricChain</span></code></a> object.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<div class="section" id="opensubtitles">
<h3>OpenSubtitles<a class="headerlink" href="#opensubtitles" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="cotk.dataloader.OpenSubtitles">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">OpenSubtitles</code><span class="sig-paren">(</span><em>file_id='resources://OpenSubtitles'</em>, <em>min_vocab_times=10</em>, <em>max_sent_length=50</em>, <em>invalid_vocab_times=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/single_turn_dialog.html#OpenSubtitles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.OpenSubtitles" title="Permalink to this definition">¶</a></dt>
<dd><p>A dataloader for OpenSubtitles dataset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>file_id</strong> (<em>str</em>) – A string indicating the source of OpenSubtitles dataset.
Default: <code class="docutils literal notranslate"><span class="pre">resources://OpenSubtitles</span></code>. A preset dataset is downloaded and cached.</li>
<li><strong>min_vocab_times</strong> (<em>int</em>) – A cut-off threshold of valid tokens. All tokens appear
not less than <cite>min_vocab_times</cite> in <strong>training set</strong> will be marked as valid words.
Default: <code class="docutils literal notranslate"><span class="pre">10</span></code>.</li>
<li><strong>max_sent_length</strong> (<em>int</em>) – All sentences longer than <cite>max_sent_length</cite> will be shortened
to first <cite>max_sent_length</cite> tokens. Default: <code class="docutils literal notranslate"><span class="pre">50</span></code>.</li>
<li><strong>invalid_vocab_times</strong> (<em>int</em>) – A cut-off threshold of invalid tokens. All tokens appear
not less than <cite>invalid_vocab_times</cite> in the <strong>whole dataset</strong> (except valid words) will be
marked as invalid vocabs. Otherwise, they are unknown words, both in training or
testing stages. Default: <code class="docutils literal notranslate"><span class="pre">0</span></code> (No unknown words).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Refer to <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog" title="cotk.dataloader.SingleTurnDialog"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingleTurnDialog</span></code></a> for attributes and methods.</p>
<p class="rubric">References</p>
<p>[1] <a class="reference external" href="http://opus.nlpl.eu/OpenSubtitles.php">http://opus.nlpl.eu/OpenSubtitles.php</a></p>
<p>[2] P. Lison and J. Tiedemann, OpenSubtitles2016: Extracting Large Parallel Corpora from
Movie and TV Subtitles. LREC 2016.</p>
<dl class="method">
<dt id="cotk.dataloader.OpenSubtitles._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/single_turn_dialog.html#OpenSubtitles._load_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.OpenSubtitles._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loading dataset, invoked during the initialization of <a class="reference internal" href="#cotk.dataloader.SingleTurnDialog" title="cotk.dataloader.SingleTurnDialog"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingleTurnDialog</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="multiturndialog">
<h2>MultiTurnDialog<a class="headerlink" href="#multiturndialog" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cotk.dataloader.MultiTurnDialog">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">MultiTurnDialog</code><span class="sig-paren">(</span><em>ext_vocab=None</em>, <em>key_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#MultiTurnDialog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for multi-turn dialog datasets. This is an abstract class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code></li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. Default: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>ext_vocab</strong> (<em>list</em>) – special tokens, placed at beginning of <code class="docutils literal notranslate"><span class="pre">vocab_list</span></code>.
For example: <code class="docutils literal notranslate"><span class="pre">[&quot;&lt;pad&gt;&quot;,</span> <span class="pre">&quot;&lt;unk&gt;&quot;,</span> <span class="pre">&quot;&lt;go&gt;&quot;,</span> <span class="pre">&quot;&lt;eos&gt;&quot;]</span></code>.</li>
<li><strong>pad_id</strong> (<em>int</em>) – token for padding, always equal to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</li>
<li><strong>unk_id</strong> (<em>int</em>) – token for unknown words, always equal to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</li>
<li><strong>go_id</strong> (<em>int</em>) – token at the beginning of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</li>
<li><strong>eos_id</strong> (<em>int</em>) – token at the end of sentences, always equal to <code class="docutils literal notranslate"><span class="pre">3</span></code>.</li>
<li><strong>key_name</strong> (<em>list</em>) – name of subsets of the data. For example: <code class="docutils literal notranslate"><span class="pre">[&quot;train&quot;,</span> <span class="pre">&quot;dev&quot;,</span> <span class="pre">&quot;test&quot;]</span></code>.</li>
<li><strong>all_vocab_list</strong> (<em>list</em>) – vocabulary list of the datasets,
including valid vocabs and invalid vocabs.</li>
<li><strong>word2id</strong> (<em>dict</em>) – a dict mapping all vocab to index. You don’t need to use it
at most times, see <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.convert_tokens_to_ids" title="cotk.dataloader.MultiTurnDialog.convert_tokens_to_ids"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_tokens_to_ids()</span></code></a> instead.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="cotk.dataloader.MultiTurnDialog.vocab_list">
<code class="descname">vocab_list</code><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.vocab_list" title="Permalink to this definition">¶</a></dt>
<dd><p>valid vocab list, equals to <code class="docutils literal notranslate"><span class="pre">all_vocab_list[：valid_vocab_len]</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.MultiTurnDialog.vocab_size">
<code class="descname">vocab_size</code><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">valid_vocab_len</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="cotk.dataloader.MultiTurnDialog.all_vocab_size">
<code class="descname">all_vocab_size</code><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.all_vocab_size" title="Permalink to this definition">¶</a></dt>
<dd><p>equals to <code class="docutils literal notranslate"><span class="pre">len(self.all_vocab_list)</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called during the initialization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(tuple)</em> – containing:<ul class="simple">
<li><strong>all_vocab_list</strong> (list): vocabulary list of the datasets,
including valid and invalid vocabs.</li>
<li><strong>valid_vocab_len</strong> (int): the number of valid vocab.
<code class="docutils literal notranslate"><span class="pre">vocab_list[:valid_vocab_len]</span></code> will be regarded as valid vocabs,
while <code class="docutils literal notranslate"><span class="pre">vocab_list[valid_vocab_len:]</span></code> regarded as invalid vocabs.</li>
<li><strong>data</strong> (dict): a dict contains data.</li>
<li><strong>data_size</strong> (dict): a dict contains size of each item in data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog._valid_word2id">
<code class="descname">_valid_word2id</code><span class="sig-paren">(</span><em>word</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog._valid_word2id" title="Permalink to this definition">¶</a></dt>
<dd><p>This function return the id for a valid word, otherwise return <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>word</strong> (<em>str</em>) – a word.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.restart">
<code class="descname">restart</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.restart" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize batches. This function be called before <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.get_next_batch" title="cotk.dataloader.MultiTurnDialog.get_next_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batch()</span></code></a>
or an epoch is end.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int</em>) – the number of sample in a batch.
default: if <code class="docutils literal notranslate"><span class="pre">None</span></code>, last <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> is used.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.get_batch">
<code class="descname">get_batch</code><span class="sig-paren">(</span><em>key</em>, <em>index</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#MultiTurnDialog.get_batch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.get_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a batch of specified <cite>index</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>index</strong> (<em>list</em>) – a list of specified index</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p><em>(dict)</em> – A dict at least contains:</p>
<ul class="simple">
<li>turn_length(list): A 1-d list, the number of turns in sessions.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code></li>
<li>sent_length(list): A 2-d non-padded list, the length of sentence in turns.
The second dimension is various in different session.
Length of outer list: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code></li>
<li>sent(<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 3-d padding array containing words of index form.
Only provide valid words. <cite>unk_id</cite> will be used if a word is not valid.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(turn_length[i]),</span> <span class="pre">max(sent_length)]</span></code></li>
<li>sent_allvocabs(<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 3-d padding array containing words of index form.
Provide both valid and invalid vocabs.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(turn_length[i]),</span> <span class="pre">max(sent_length)]</span></code></li>
</ul>
<p>See the example belows.</p>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;hello&quot;, &quot;i&quot;, &quot;am&quot;, &quot;fine&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;, &quot;hello&quot;, &quot;i&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">get_batch</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="go">{</span>
<span class="go">        &quot;sent_allvocabs&quot;: numpy.array([</span>
<span class="go">                [[2, 7, 3, 0, 0, 0],   # 1st sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 3, 0, 0, 0],    # 2nd sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 4, 5, 6, 3, 0],    # 3rd sentence in 1st session: &lt;go&gt; how are you &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [2, 8, 9, 10, 3, 0]],  # 4th sentence in 1st session: &lt;go&gt; i am fine &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [[2, 7, 4, 5, 6, 3],   # 1st sentence in 2nd session: &lt;go&gt; hello how are you &lt;eos&gt;</span>
<span class="go">                [2, 8, 9, 10, 3, 0],   # 2nd sentence in 2nd session: &lt;go&gt; i am fine &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [0, 0, 0, 0, 0, 0],</span>
<span class="go">                [0, 0, 0, 0, 0, 0]]</span>
<span class="go">        ]),</span>
<span class="go">        &quot;sent&quot;: numpy.array([</span>
<span class="go">                [[2, 7, 3, 0, 0, 0],  # 1st sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 3, 0, 0, 0],   # 2nd sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 4, 5, 6, 3, 0],   # 3rd sentence in 1st session: &lt;go&gt; how are you &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [2, 8, 1, 1, 3, 0]],  # 4th sentence in 1st session: &lt;go&gt; i &lt;unk&gt; &lt;unk&gt; &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [[2, 7, 4, 5, 6, 3],  # 1st sentence in 2nd session: &lt;go&gt; hello how are you &lt;eos&gt;</span>
<span class="go">                [2, 8, 1, 1, 3, 0],   # 2nd sentence in 2nd session: &lt;go&gt; i &lt;unk&gt; &lt;unk&gt; &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [0, 0, 0, 0, 0, 0],</span>
<span class="go">                [0, 0, 0, 0, 0, 0]]</span>
<span class="go">        ]),</span>
<span class="go">        &quot;turn_length&quot;: [4, 2], # the number of turns in each session</span>
<span class="go">        &quot;sent_length&quot;: [[3, 3, 5, 5], [6, 5]], # length of sentences</span>
<span class="go">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.get_next_batch">
<code class="descname">get_next_batch</code><span class="sig-paren">(</span><em>key</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.get_next_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get next batch. It can be called only after Initializing batches (<a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.restart" title="cotk.dataloader.MultiTurnDialog.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A dict like <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.get_batch" title="cotk.dataloader.MultiTurnDialog.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>, or None if the epoch is end.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.get_batches">
<code class="descname">get_batches</code><span class="sig-paren">(</span><em>key</em>, <em>batch_size=None</em>, <em>shuffle=True</em>, <em>ignore_left_samples=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.get_batches" title="Permalink to this definition">¶</a></dt>
<dd><p>An iterator over batches. It first call <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.restart" title="cotk.dataloader.MultiTurnDialog.restart"><code class="xref py py-func docutils literal notranslate"><span class="pre">restart()</span></code></a>, and then <code class="xref py py-func docutils literal notranslate"><span class="pre">get_next_batches()</span></code>                      until no more data is available.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>batch_size</strong> (<em>int, optional</em>) – default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.  Use <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> by default.</li>
<li><strong>shuffle</strong> (<em>bool</em>) – whether to shuffle the data. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
<li><strong>ignore_left_samples</strong> (<em>bool</em>) – If the number of left samples is not equal to
<code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, ignore them. This make sure all batches have same number of samples.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">An iterator where each element is like <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.get_batch" title="cotk.dataloader.MultiTurnDialog.get_batch"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_batch()</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.trim_index">
<code class="descname">trim_index</code><span class="sig-paren">(</span><em>index</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.trim_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Trim a sentence represented by index. There will be two steps:</p>
<blockquote>
<div><ul class="simple">
<li>If there is an end token (<code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>) in the sentence,
find first end token and abandon words after it (included the end token).</li>
<li>ignore <code class="docutils literal notranslate"><span class="pre">&lt;pad&gt;</span></code> s at the end of the sentence.</li>
</ul>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>index</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – a list of int</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><em>(list)</em> – a list of trimmed index</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">trim_index</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">... </span><span class="c1"># &lt;go&gt; I have been to China &lt;pad&gt; &lt;pad&gt; &lt;eos&gt; I &lt;eos&gt; &lt;pad&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="c1"># &lt;go&gt; I have been to China</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.multi_turn_trim_index">
<code class="descname">multi_turn_trim_index</code><span class="sig-paren">(</span><em>index</em>, <em>turn_length=None</em>, <em>ignore_first_token=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#MultiTurnDialog.multi_turn_trim_index"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.multi_turn_trim_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Trim indexes for multi turn dialog. There will be 3 steps:</p>
<ul class="simple">
<li>For every turn, if there is an <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>, find first <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code> and abandon words after it (included the <code class="docutils literal notranslate"><span class="pre">&lt;eos&gt;</span></code>).</li>
<li>Ignore <code class="docutils literal notranslate"><span class="pre">&lt;pad&gt;</span></code> s at the end of every turn.</li>
<li>When <code class="docutils literal notranslate"><span class="pre">turn_length</span></code> is None, discard the first empty turn and the turn after it. Otherwise, discard the turn according to turn_length.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – a 2-d jagged array of int.
Size: <code class="docutils literal notranslate"><span class="pre">[turn_length,</span> <span class="pre">~sent_length]</span></code>, where “~” means different sizes
in this dimension is allowed.</li>
<li><strong>turn_length</strong> (<em>int</em>) – Default: <code class="docutils literal notranslate"><span class="pre">None</span></code></li>
<li><strong>ignore_first_token</strong> (<em>bool</em>) – if True, ignore first token of each turn (must be <code class="docutils literal notranslate"><span class="pre">&lt;go&gt;</span></code>).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list) a jagged 2-d array of trimmed index. Size</em> – <code class="docutils literal notranslate"><span class="pre">[turn_length,</span> <span class="pre">~sent_length]</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;, &quot;Japan&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">multi_turn_trim_index</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># &lt;go&gt; I have been to China &lt;pad&gt; &lt;pad&gt; &lt;eos&gt; I &lt;eos&gt; &lt;pad&gt;</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>        <span class="c1"># &lt;go&gt; I have been to Japan &lt;eos&gt; &lt;pad&gt; &lt;eos&gt; I &lt;eos&gt; &lt;pad&gt;</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span>        <span class="c1"># &lt;go&gt; I have been to China &lt;pad&gt; &lt;pad&gt; &lt;eos&gt; I &lt;eos&gt; &lt;pad&gt;</span>
<span class="gp">... </span>    <span class="n">turn_length</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_first_token</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">[[2, 4, 5, 6, 7, 8], [2, 4, 5, 6, 7, 9]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">multi_turn_trim_index</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span>    <span class="n">turn_length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ignore_first_token</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">[[2, 4, 5, 6, 7, 8]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">multi_turn_trim_index</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span>    <span class="n">turn_length</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_first_token</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="go">[[4, 5, 6, 7, 8], [4, 5, 6, 7, 9]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.convert_tokens_to_ids">
<code class="descname">convert_tokens_to_ids</code><span class="sig-paren">(</span><em>sent</em>, <em>invalid_vocab=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.convert_tokens_to_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from string to index representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sent</strong> (<em>list</em>) – a list of string, representing each token of the sentences.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – whether to provide invalid vocabs.
If <code class="docutils literal notranslate"><span class="pre">False</span></code>, invalid vocabs will be replaced by <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, invalid vocabs will using their own id.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of indexes</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;, &quot;been&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.convert_multi_turn_tokens_to_ids">
<code class="descname">convert_multi_turn_tokens_to_ids</code><span class="sig-paren">(</span><em>session</em>, <em>invalid_vocab=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#MultiTurnDialog.convert_multi_turn_tokens_to_ids"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.convert_multi_turn_tokens_to_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a session from string to index representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>session</strong> (<em>list</em>) – a jagged 2-d list of string, representing each token of the session.
Size: <code class="docutils literal notranslate"><span class="pre">[turn_length,</span> <span class="pre">~sent_length]</span></code>, where “~” means different sizes
in this dimension is allowed.</li>
<li><strong>invalid_vocab</strong> (<em>bool</em>) – whether to provide invalid vocabs.
If <code class="docutils literal notranslate"><span class="pre">False</span></code>, invalid vocabs will be transferred to <code class="docutils literal notranslate"><span class="pre">unk_id</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, invalid vocabs will using their own id.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;, &quot;Japan&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;, &quot;been&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_multi_turn_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;Japan&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">]],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_multi_turn_tokens_to_ids</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;Japan&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">]],</span> <span class="n">invalid_vocab</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.convert_ids_to_tokens">
<code class="descname">convert_ids_to_tokens</code><span class="sig-paren">(</span><em>index</em>, <em>trim=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.convert_ids_to_tokens" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sentence from index to string representation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>list</em>) – a list of int.</li>
<li><strong>trim</strong> (<em>bool</em>) – if True, call <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.trim_index" title="cotk.dataloader.MultiTurnDialog.trim_index"><code class="xref py py-func docutils literal notranslate"><span class="pre">trim_index()</span></code></a> before convertion.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><em>(list)</em> – a list of tokens</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.convert_multi_turn_ids_to_tokens">
<code class="descname">convert_multi_turn_ids_to_tokens</code><span class="sig-paren">(</span><em>index</em>, <em>trim=True</em>, <em>turn_length=None</em>, <em>ignore_first_token=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#MultiTurnDialog.convert_multi_turn_ids_to_tokens"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.convert_multi_turn_ids_to_tokens" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a session from index to string representation</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>index</strong> (list or <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – a jagged 2-d array of int.
Size: <code class="docutils literal notranslate"><span class="pre">[turn_length,</span> <span class="pre">~sent_length]</span></code>, where where “~” means different sizes
in this dimension is allowed.</li>
<li><strong>trim</strong> (<em>bool</em>) – if True, call <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog.multi_turn_trim_index" title="cotk.dataloader.MultiTurnDialog.multi_turn_trim_index"><code class="xref py py-func docutils literal notranslate"><span class="pre">multi_turn_trim_index()</span></code></a> before convertion.</li>
<li><strong>turn_length</strong> (<em>int</em>) – Only works when trim=``True``.
If True, the session is trimmed according the turn_length. Default: None</li>
<li><strong>ignore_first_token</strong> (<em>bool</em>) – Only works when trim=``True``.
If True, ignore first token of each turn (must be <cite>&lt;go&gt;</cite>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;I&quot;, &quot;have&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;been&quot;, &quot;to&quot;, &quot;China&quot;, &quot;Japan&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_multi_turn_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">turn_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_first_token</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;Japan&quot;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_multi_turn_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">turn_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignore_first_token</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_multi_turn_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
<span class="gp">... </span><span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">turn_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_first_token</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;Japan&quot;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">convert_multi_turn_ids_to_tokens</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;China&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">[</span><span class="s2">&quot;&lt;go&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;have&quot;</span><span class="p">,</span> <span class="s2">&quot;been&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;Japan&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;eos&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;pad&gt;&quot;</span><span class="p">]]</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><em>(list)</em> – a list of trimmed index</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.get_teacher_forcing_metric">
<code class="descname">get_teacher_forcing_metric</code><span class="sig-paren">(</span><em>multi_turn_gen_log_prob_key='multi_turn_gen_log_prob'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#MultiTurnDialog.get_teacher_forcing_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.get_teacher_forcing_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metric for teacher-forcing.</p>
<p>It contains:</p>
<ul class="simple">
<li><a class="reference internal" href="metric.html#cotk.metric.MultiTurnPerplexityMetric" title="cotk.metric.MultiTurnPerplexityMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MultiTurnPerplexityMetric</span></code></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>gen_log_prob_key</strong> (<em>str</em>) – The key of predicted log probablilty over words.
Refer to <a class="reference internal" href="metric.html#cotk.metric.MultiTurnPerplexityMetric" title="cotk.metric.MultiTurnPerplexityMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MultiTurnPerplexityMetric</span></code></a>. Default: <code class="docutils literal notranslate"><span class="pre">gen_log_prob</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="metric.html#cotk.metric.MetricChain" title="cotk.metric.MetricChain"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MetricChain</span></code></a> object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.MultiTurnDialog.get_inference_metric">
<code class="descname">get_inference_metric</code><span class="sig-paren">(</span><em>multi_turn_gen_key='multi_turn_gen'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#MultiTurnDialog.get_inference_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.MultiTurnDialog.get_inference_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metric for inference.</p>
<p>It contains:</p>
<ul class="simple">
<li><a class="reference internal" href="metric.html#cotk.metric.BleuCorpusMetric" title="cotk.metric.BleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.BleuCorpusMetric</span></code></a></li>
<li><a class="reference internal" href="metric.html#cotk.metric.MultiTurnDialogRecorder" title="cotk.metric.MultiTurnDialogRecorder"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MultiTurnDialogRecorder</span></code></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>gen_key</strong> (<em>str</em>) – The key of generated sentences in index form.
Refer to <a class="reference internal" href="metric.html#cotk.metric.BleuCorpusMetric" title="cotk.metric.BleuCorpusMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.BleuCorpusMetric</span></code></a> or <a class="reference internal" href="metric.html#cotk.metric.MultiTurnDialogRecorder" title="cotk.metric.MultiTurnDialogRecorder"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MultiTurnDialogRecorder</span></code></a>.
Default: <code class="docutils literal notranslate"><span class="pre">gen</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="metric.html#cotk.metric.MetricChain" title="cotk.metric.MetricChain"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MetricChain</span></code></a> object.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<div class="section" id="ubuntucorpus">
<h3>UbuntuCorpus<a class="headerlink" href="#ubuntucorpus" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="cotk.dataloader.UbuntuCorpus">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">UbuntuCorpus</code><span class="sig-paren">(</span><em>file_id='resources://Ubuntu'</em>, <em>min_vocab_times=10</em>, <em>max_sent_length=50</em>, <em>max_turn_length=20</em>, <em>invalid_vocab_times=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#UbuntuCorpus"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.UbuntuCorpus" title="Permalink to this definition">¶</a></dt>
<dd><p>A dataloader for Ubuntu dataset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>file_id</strong> (<em>str</em>) – a str indicates the source of UbuntuCorpus dataset.
Default: <code class="docutils literal notranslate"><span class="pre">resources://Ubuntu</span></code>. A preset dataset is downloaded and cached.</li>
<li><strong>min_vocab_times</strong> (<em>int</em>) – A cut-off threshold of valid tokens. All tokens appear
not less than <cite>min_vocab_times</cite> in <strong>training set</strong> will be marked as valid words.
Default: <code class="docutils literal notranslate"><span class="pre">10</span></code>.</li>
<li><strong>max_sent_length</strong> (<em>int</em>) – All sentences longer than <code class="docutils literal notranslate"><span class="pre">max_sent_length</span></code> will be shortened
to first <code class="docutils literal notranslate"><span class="pre">max_sent_length</span></code> tokens. Default: <code class="docutils literal notranslate"><span class="pre">50</span></code>.</li>
<li><strong>max_turn_length</strong> (<em>int</em>) – All sessions longer than <code class="docutils literal notranslate"><span class="pre">max_turn_length</span></code> will be shortened
to first <code class="docutils literal notranslate"><span class="pre">max_turn_length</span></code> sentences. Default: <code class="docutils literal notranslate"><span class="pre">20</span></code>.</li>
<li><strong>invalid_vocab_times</strong> (<em>int</em>) – A cut-off threshold of invalid tokens. All tokens appear
not less than <code class="docutils literal notranslate"><span class="pre">invalid_vocab_times</span></code> in the <strong>whole dataset</strong> (except valid words) will be
marked as invalid words. Otherwise, they are unknown words, both in training or
testing stages. Default: <code class="docutils literal notranslate"><span class="pre">0</span></code> (No unknown words).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Refer to <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog" title="cotk.dataloader.MultiTurnDialog"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiTurnDialog</span></code></a> for attributes and methods.</p>
<p class="rubric">References</p>
<p>[1] <a class="reference external" href="http://dataset.cs.mcgill.ca/ubuntu-corpus-1.0">http://dataset.cs.mcgill.ca/ubuntu-corpus-1.0</a></p>
<p>[2] <a class="reference external" href="https://github.com/rkadlec/ubuntu-ranking-dataset-creator">https://github.com/rkadlec/ubuntu-ranking-dataset-creator</a></p>
<p>[3] Lowe R, Pow N, Serban I, et al. The Ubuntu Dialogue Corpus: A Large Dataset
for Research in Unstructured Multi-Turn Dialogue Systems. SIGDIAL 2015.</p>
<dl class="method">
<dt id="cotk.dataloader.UbuntuCorpus._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#UbuntuCorpus._load_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.UbuntuCorpus._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loading dataset, invoked during the initialization of <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog" title="cotk.dataloader.MultiTurnDialog"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiTurnDialog</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="switchboardcorpus">
<h3>SwitchBoardCorpus<a class="headerlink" href="#switchboardcorpus" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="cotk.dataloader.SwitchboardCorpus">
<em class="property">class </em><code class="descclassname">cotk.dataloader.</code><code class="descname">SwitchboardCorpus</code><span class="sig-paren">(</span><em>file_id='resources://SwitchboardCorpus'</em>, <em>min_vocab_times=5</em>, <em>max_sent_length=50</em>, <em>max_turn_length=1000</em>, <em>invalid_vocab_times=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#SwitchboardCorpus"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SwitchboardCorpus" title="Permalink to this definition">¶</a></dt>
<dd><p>A dataloader for Switchboard dataset.</p>
<p>In this dataset, all sessions start with a <code class="docutils literal notranslate"><span class="pre">&lt;d&gt;</span></code> representing empty context.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>file_id</strong> (<em>str</em>) – a string indicating the source of SwitchboardCorpus dataset.
Default: <code class="docutils literal notranslate"><span class="pre">resources://SwitchboardCorpus</span></code>. A preset dataset is downloaded and cached.</li>
<li><strong>min_vocab_times</strong> (<em>int</em>) – A cut-off threshold of valid tokens. All tokens appear
not less than <cite>min_vocab_times</cite> in <strong>training set</strong> will be marked as valid words.
Default: <code class="docutils literal notranslate"><span class="pre">10</span></code>.</li>
<li><strong>max_sent_length</strong> (<em>int</em>) – All sentences longer than <code class="docutils literal notranslate"><span class="pre">max_sent_length</span></code> will be shortened
to first <code class="docutils literal notranslate"><span class="pre">max_sent_length</span></code> tokens. Default: <code class="docutils literal notranslate"><span class="pre">50</span></code>.</li>
<li><strong>max_turn_length</strong> (<em>int</em>) – All sessions longer than <code class="docutils literal notranslate"><span class="pre">max_turn_length</span></code> will be shortened
to first <code class="docutils literal notranslate"><span class="pre">max_turn_length</span></code> sentences. Default: <code class="docutils literal notranslate"><span class="pre">20</span></code>.</li>
<li><strong>invalid_vocab_times</strong> (<em>int</em>) – A cut-off threshold of invalid tokens. All tokens appear
not less than <code class="docutils literal notranslate"><span class="pre">invalid_vocab_times</span></code> in the <strong>whole dataset</strong> (except valid words) will be
marked as invalid words. Otherwise, they are unknown words, both in training or
testing stages. Default: <code class="docutils literal notranslate"><span class="pre">0</span></code> (No unknown words).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Refer to <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog" title="cotk.dataloader.MultiTurnDialog"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiTurnDialog</span></code></a> for attributes and methods.</p>
<p class="rubric">References</p>
<p>[1] <a class="reference external" href="https://catalog.ldc.upenn.edu/LDC97S62">https://catalog.ldc.upenn.edu/LDC97S62</a></p>
<p>[2] John J G and Edward H. Switchboard-1 release 2. Linguistic Data Consortium, Philadelphia 1997.</p>
<dl class="method">
<dt id="cotk.dataloader.SwitchboardCorpus._load_data">
<code class="descname">_load_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#SwitchboardCorpus._load_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SwitchboardCorpus._load_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Loading dataset, invoked during the initialization of <a class="reference internal" href="#cotk.dataloader.MultiTurnDialog" title="cotk.dataloader.MultiTurnDialog"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiTurnDialog</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SwitchboardCorpus.get_batch">
<code class="descname">get_batch</code><span class="sig-paren">(</span><em>key</em>, <em>index</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#SwitchboardCorpus.get_batch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SwitchboardCorpus.get_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a batch of specified <cite>index</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>str</em>) – key name of dataset, must be contained in <code class="docutils literal notranslate"><span class="pre">self.key_name</span></code>.</li>
<li><strong>index</strong> (<em>list</em>) – a list of specified index</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p><em>(dict)</em> – A dict contains what is in the return of MultiTurnDialog.get_batch.</p>
<ul>
<li><p class="first">turn_length(list): A 1-d list, the number of turns in sessions.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code></p>
</li>
<li><p class="first">sent_length(list): A 2-d non-padded list, the length of sentence in turns.
The second dimension is various in different session.
Length of outer list: <code class="docutils literal notranslate"><span class="pre">[batch_size]</span></code></p>
</li>
<li><p class="first">sent(<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 3-d padding array containing words of index form.
Only provide valid words. <cite>unk_id</cite> will be used if a word is not valid.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(turn_length[i]),</span> <span class="pre">max(sent_length)]</span></code></p>
</li>
<li><p class="first">sent_allvocabs(<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>): A 3-d padding array containing words of index form.
Provide both valid and invalid vocabs.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">max(turn_length[i]),</span> <span class="pre">max(sent_length)]</span></code></p>
<blockquote>
<div><p>It additionally contains:</p>
<ul class="simple">
<li>candidate_allvocabs (list): A 3-d list, multiple responses for a session.
Size: <code class="docutils literal notranslate"><span class="pre">[batch_size,</span> <span class="pre">~reference_num,</span> <span class="pre">~sent_length]</span></code>, where “~” means different sizes
in this dimension is allowed.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>See the example belows.</p>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># all_vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#   &quot;hello&quot;, &quot;i&quot;, &quot;am&quot;, &quot;fine&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_size = 9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># vocab_list = [&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;, &quot;&lt;go&gt;&quot;, &quot;&lt;eos&gt;&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;, &quot;hello&quot;, &quot;i&quot;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataloader</span><span class="o">.</span><span class="n">get_batch</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="go">{</span>
<span class="go">        &quot;sent_allvocabs&quot;: numpy.array([</span>
<span class="go">                [[2, 7, 3, 0, 0, 0],   # 1st sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 3, 0, 0, 0],    # 2nd sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 4, 5, 6, 3, 0],    # 3rd sentence in 1st session: &lt;go&gt; how are you &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [2, 8, 9, 10, 3, 0]],  # 4th sentence in 1st session: &lt;go&gt; i am fine &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [[2, 7, 4, 5, 6, 3],   # 1st sentence in 2nd session: &lt;go&gt; hello how are you &lt;eos&gt;</span>
<span class="go">                [2, 8, 9, 10, 3, 0],   # 2nd sentence in 2nd session: &lt;go&gt; i am fine &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [0, 0, 0, 0, 0, 0],</span>
<span class="go">                [0, 0, 0, 0, 0, 0]]</span>
<span class="go">        ]),</span>
<span class="go">        &quot;sent&quot;: numpy.array([</span>
<span class="go">                [[2, 7, 3, 0, 0, 0],  # 1st sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 7, 3, 0, 0, 0],   # 2nd sentence in 1st session: &lt;go&gt; hello &lt;eos&gt; &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;</span>
<span class="go">                [2, 4, 5, 6, 3, 0],   # 3rd sentence in 1st session: &lt;go&gt; how are you &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [2, 8, 1, 1, 3, 0]],  # 4th sentence in 1st session: &lt;go&gt; i &lt;unk&gt; &lt;unk&gt; &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [[2, 7, 4, 5, 6, 3],  # 1st sentence in 2nd session: &lt;go&gt; hello how are you &lt;eos&gt;</span>
<span class="go">                [2, 8, 1, 1, 3, 0],   # 2nd sentence in 2nd session: &lt;go&gt; i &lt;unk&gt; &lt;unk&gt; &lt;eos&gt; &lt;pad&gt;</span>
<span class="go">                [0, 0, 0, 0, 0, 0],</span>
<span class="go">                [0, 0, 0, 0, 0, 0]]</span>
<span class="go">        ]),</span>
<span class="go">        &quot;turn_length&quot;: [4, 2], # the number of turns in each session</span>
<span class="go">        &quot;sent_length&quot;: [[3, 3, 5, 5], [6, 5]], # length of sentences</span>
<span class="go">&quot;candidate_allvocabs&quot;:[</span>
<span class="go">        [[2, 7, 3],                   # two responses to 1st session: &lt;go&gt; hello &lt;eos&gt;</span>
<span class="go">         [2, 6, 5, 10, 3]],           #                               &lt;go&gt; you are fine &lt;eos&gt;</span>
<span class="go">        [[2, 6, 5, 10, 3]]]           # one response to 2nd session:  &lt;go&gt; you are fine &lt;eos&gt;</span>
<span class="go">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cotk.dataloader.SwitchboardCorpus.get_multi_ref_metric">
<code class="descname">get_multi_ref_metric</code><span class="sig-paren">(</span><em>generated_num_per_context=20</em>, <em>embed=None</em>, <em>multiple_gen_key='multiple_gen_key'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/cotk/dataloader/multi_turn_dialog.html#SwitchboardCorpus.get_multi_ref_metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cotk.dataloader.SwitchboardCorpus.get_multi_ref_metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Get metrics for multiple references.</p>
<p>It contains:</p>
<ul class="simple">
<li><a class="reference internal" href="metric.html#cotk.metric.BleuPrecisionRecallMetric" title="cotk.metric.BleuPrecisionRecallMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.BleuPrecisionRecallMetric</span></code></a></li>
<li><a class="reference internal" href="metric.html#cotk.metric.EmbSimilarityPrecisionRecallMetric" title="cotk.metric.EmbSimilarityPrecisionRecallMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.EmbSimilarityPrecisionRecallMetric</span></code></a></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>generated_num_per_context</strong> (<em>int</em>) – The number of sentences generated per context.</li>
<li><strong>embed</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) – Word embedding for embedding similarity.
Default: if <code class="docutils literal notranslate"><span class="pre">None</span></code>, using glove word embedding from <code class="docutils literal notranslate"><span class="pre">resources://Glove300d</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A <a class="reference internal" href="metric.html#cotk.metric.MetricChain" title="cotk.metric.MetricChain"><code class="xref py py-class docutils literal notranslate"><span class="pre">metric.MetricChain</span></code></a> object.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="wordvector.html" class="btn btn-neutral float-right" title="Word Vector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="notes/quickstart.html" class="btn btn-neutral float-left" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, thu-coai

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>